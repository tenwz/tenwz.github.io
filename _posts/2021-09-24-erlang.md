---
layout: post
title: 轻量级Erlang进程


---

Erlang 进程的堆栈信息远没有系统进程那么多，基本上只是函数本身、相关的metadata、入口指针。

- Erlang进程的堆栈是动态分配、随使用增长的，新建一个Erlang进程的开销远比系统进程/线程小得多，开销就像在OO语言中建立一个新对象般简单。
- 普通进程/线程的内存管理是基于页的，而页对于一个函数+一点点零碎来说都太大了。而实际中OS分配给普通进程的初始栈可以达到Megabytes级别。
- Erlang进程之间是隔离的，没有共享状态，所有的消息都是异步的，不会继承大量的已有状态。
- Erlang进程的调度是在Erlang VM内发生的，跟OS层没啥关系，无需普通进程/线程切换时的各种开销。Erlang进程的切换是一种类似直接“跳转”的方式，以O(1)复杂度实现。Erlang调度器会管理这些切换，大概只需要几十个指令和数十纳秒的时间。普通线程的切换会需要数百上前纳秒，OS调度器的运作复杂度可能是O(logn)或者O(log(logn))。如果有上万个线程，这个时间将会大幅提升。



